<root BTCPP_format="4">
    <!-- Include necessary subtrees -->
    <include path="./subtrees/cam_find_and_track_ball.xml" />
    <include path="./subtrees/locate.xml" />
    <include path="./subtrees/find_ball.xml" />

    <BehaviorTree ID="MainTree">
        <ReactiveSequence>
            <!-- Vision & Localization -->
            <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
            <SelfLocate mode="trust_direction" /> 
            <CamScanField _while="!odom_calibrated"/>
            
            <!-- 킥 방향 개선 (골키퍼 고려) -->
            <CalcKickDirWithGoalkeeper cross_threshold="0.5" goalkeeper_margin="0.52" />

            <!-- 현재 striker의 kick decision 값이 들어가진 않으니 도움닫기는 adjust로만 수정 (kick 결정 ball.range < 0.8) 
            1. adjust range : 0.6
            2. adjust의 tangential_speed(공 주변 도는 속도) : 0.15
            3. kick_y_offset : 0.13

            4. 킥의 setvelocity : 1.3
            5. 킥 상태를 유지하는 최소 시간 min_msec_kick : 1000 -> non-stop은 300
            6. 킥 직전/직후에 자세를 안정화하기 위해 대기하는 시간 msecs_stablize : 1000 -> non-stop은 100
            -->
            
            <Sequence>
                <Chase vx_limit="0.9" vy_limit="0.2" vtheta_limit="1.0" dist="0.4" safe_dist="0.5" />

                <Adjust turn_threshold="0.5" range="0.6" vx_limit="0.7" vy_limit="0.6" vtheta_limit="1.5" vtheta_factor="1.5" tangential_speed_far="0.7" tangential_speed_near="0.15" kick_y_offset="0.13" />

                <Kick speed_limit="1.3" vx_limit="1.3" vy_limit="0.3" min_msec_kick="1000" msecs_stablize="1000" kick_type="kick" />
                
            </Sequence>
        </ReactiveSequence>
    </BehaviorTree>
</root>
